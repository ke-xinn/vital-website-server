<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vital Sign Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #eaf2f8;
      padding: 20px;
      color: #2c3e50;
    }
    h1 {
      text-align: center;
      color: #1e3799;
      margin-bottom: 30px;
    }
    .device-card {
      background: #ffffff;
      padding: 20px;
      margin: 20px auto;
      width: 95%;
      max-width: 800px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 50, 0.1);
    }
    .vital-box {
      background: #dff3fc;
      border: 2px solid #d1e9ff;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
    }
    .vital-title {
      font-weight: bold;
      color: #0c2461;
    }
    .status-tag {
      display: inline-block;
      margin-top: 5px;
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: bold;
      color: white;
    }

    /* Status colors */
    .normal { background-color: #54a0ff; }
    .hypothermia, .hypotension, .lowspo2, .bradycardia { background-color: #48dbfb; }
    .prehypertension, .hyperthermia, .tachycardia { background-color: #f6b93b; }
    .hypertension { background-color: #e55039; }
    .emergency { background-color: #b71540; }
  </style>
</head>
<body>
  <h1>Vital Sign Dashboard</h1>
  <div id="data-container"></div>

  <script>
    async function fetchData() {
      const res = await fetch('/data');
      const data = await res.json();
      const container = document.getElementById('data-container');
      container.innerHTML = '';

      Object.values(data).forEach(entry => {
        const { device_id, hr, bp_sys, bp_dia, temp, spo2 } = entry;

        let hrStatus = 'normal';
        if (hr <= 60) hrStatus = 'bradycardia';
        else if (hr >= 100) hrStatus = 'tachycardia';

        let bpStatus = 'normal';
        if (bp_sys >= 180 || bp_dia >= 120) bpStatus = 'emergency';
        else if (bp_sys < 180 || bp_dia < 120) bpStatus = 'hypertension';
        else if (bp_sys < 140 || bp_dia < 90) bpStatus = 'hypertension';
        else if (bp_sys < 130 || bp_dia < 80) bpStatus = 'prehypertension';
        else if (bp_sys < 80 || bp_dia < 60) bpStatus = 'hypotension';

        let tempStatus = 'normal';
        if (temp < 35) tempStatus = 'hypothermia';
        else if (temp > 37.5) tempStatus = 'hyperthermia';

        let spo2Status = spo2 < 95 ? 'lowspo2' : 'normal';

        const html = `
          <div class="device-card">
            
            <div class="vital-box">
              <p class="vital-title">Heart Rate: ${hr} bpm</p>
              <span class="status-tag ${hrStatus}">${hrStatus.toUpperCase()}</span>
            </div>

            ${bp_sys !== undefined && bp_dia !== undefined ? `
              <div class="vital-box">
                <p class="vital-title">Blood Pressure: ${bp_sys}/${bp_dia} mmHg</p>
                <span class="status-tag ${bpStatus}">${bpStatus.toUpperCase()}</span>
              </div>
            ` : ''}

            <div class="vital-box">
              <p class="vital-title">Temperature: ${temp} °C</p>
              <span class="status-tag ${tempStatus}">${tempStatus.toUpperCase()}</span>
            </div>

            <div class="vital-box">
              <p class="vital-title">SpO₂: ${spo2} %</p>
              <span class="status-tag ${spo2Status}">${spo2Status.toUpperCase()}</span>
            </div>

          </div>
        `;

        container.innerHTML += html;
      });
    }

    setInterval(fetchData, 3000);
    fetchData();
  </script>
</body>
</html>
